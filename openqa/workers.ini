{%- set numofworkers = pillar['workerconf'].get(grains['host'], {}).get('numofworkers', '0') %}
# This file is generated by salt - don't touch
# Hosted on https://gitlab.suse.de/openqa/salt-pillars-openqa
# numofworkers: {{ numofworkers }}

[global]
HOST={%- for webui in webuis %}{{webui}} {% endfor %}
CACHEDIRECTORY=/var/lib/openqa/cache
LOG_LEVEL=debug
{%- if numofworkers >= 15 %}
# with {{ numofworkers }} slots the setup might take long as many assets are possibly requested concurrently (see poo#96557)
MAX_SETUP_TIME=7200
{% endif %}
{% for key, value in global.items() -%}

{%- if key == 'WORKER_CLASS' -%}
{{ key }}={{ value }},{{ grains['host'] }}
{% else -%}
{{ key }}={{ value }}
{% endif -%}

{% endfor -%}

{% for workerid, details in workers.items() %}
[{{ workerid }}]
{% for key, value in details.items() -%}

{%- if key == 'WORKER_CLASS' -%}
{{ key }}={{ value }},{{ grains['host'] }}
{% else -%}
{{ key }}={{ value }}
{% endif -%}

{%- endfor -%}
{% endfor %}

{%- for webui in webuis %}
{%- set webui_config = pillar.get('workerconf', {})['available_webuis'][webui] %}
[{{ webui }}]
TESTPOOLSERVER = {{ webui_config['testpoolurl'] }}
{% endfor %}
