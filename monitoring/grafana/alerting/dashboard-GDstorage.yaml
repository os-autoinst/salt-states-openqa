---
apiVersion: 1
groups:
- folder: Salt
  interval: 1m
  name: 'storage: Disk I/O time alert'
  orgId: 1
  rules:
  - annotations:
      __alertId__: '328'
      __dashboardUid__: GDstorage
      __panelId__: '56720'
      message: ''
    condition: A
    dashboardUid: GDstorage
    data:
    - datasourceUid: __expr__
      model:
        conditions:
        - evaluator:
            params:
            - 20000
            type: gt
          operator:
            type: and
          query:
            params:
            - C
          reducer:
            type: avg
        refId: A
        type: classic_conditions
      refId: A
    - datasourceUid: '000000001'
      model:
        alias: $tag_name
        groupBy:
        - params:
          - $__interval
          type: time
        - params:
          - name
          type: tag
        - params:
          - 'null'
          type: fill
        interval: 1m
        measurement: diskio
        orderByTime: ASC
        policy: default
        query: SELECT non_negative_derivative(mean("io_time"), 1s) FROM "diskio" WHERE
          ("host" = 'storage' AND ("name" <> 'nvme0n1' OR "name" = 'nvme1n1' OR "name"
          = 'sda' OR "name" = 'sdb')) AND $timeFilter GROUP BY time($__interval),
          "name" fill(null)
        rawQuery: true
        refId: C
        resultFormat: time_series
        select:
        - - params:
            - read_time
            type: field
          - params: []
            type: mean
          - params:
            - 1s
            type: non_negative_derivative
        tags:
        - key: host
          operator: =
          value: storage
        - condition: AND
          key: name
          operator: <>
          value: nvme0n1
        - condition: OR
          key: name
          operator: =
          value: nvme1n1
        - condition: OR
          key: name
          operator: =
          value: sda
        - condition: OR
          key: name
          operator: =
          value: sdb
      refId: C
      relativeTimeRange:
        from: 300
        to: 0
    execErrState: Error
    for: 5m
    isPaused: false
    labels:
      __contacts__: '"osd-admins"'
      rule_uid: 8WAh5ifVz
    noDataState: NoData
    panelId: 56720
    title: 'storage: Disk I/O time alert'
    uid: 8WAh5ifVz
- folder: Salt
  interval: 1m
  name: 'storage: Memory usage alert'
  orgId: 1
  rules:
  - annotations:
      __alertId__: '313'
      __dashboardUid__: GDstorage
      __panelId__: '12054'
      message: ''
    condition: A
    dashboardUid: GDstorage
    data:
    - datasourceUid: __expr__
      model:
        conditions:
        - evaluator:
            params:
            - 0.1
            type: lt
          operator:
            type: and
          query:
            params:
            - Available percentage
          reducer:
            type: avg
        refId: A
        type: classic_conditions
      refId: A
    - datasourceUid: '000000001'
      model:
        alias: available (percentage)
        dsType: influxdb
        function: mean
        groupBy:
        - interval: auto
          params:
          - auto
          type: time
        - key: host
          params:
          - tag
          type: tag
        interval: 1m
        measurement: mem_inactive
        orderByTime: ASC
        policy: default
        query: SELECT mean(available) / mean(total) as available_p  FROM "mem" WHERE
          host = 'storage' AND $timeFilter GROUP BY time($interval), host ORDER BY
          asc
        rawQuery: true
        refId: Available percentage
        resultFormat: time_series
        select:
        - - params:
            - value
            type: field
          - params: []
            type: mean
        tags: []
      refId: Available percentage
      relativeTimeRange:
        from: 300
        to: 0
    execErrState: Error
    for: 5m
    isPaused: false
    labels:
      __contacts__: '"osd-admins"'
      rule_uid: AZAhcmf4z
    noDataState: NoData
    panelId: 12054
    title: 'storage: Memory usage alert'
    uid: AZAhcmf4z
- folder: Salt
  interval: 1m
  name: 'storage: NTP offset alert'
  orgId: 1
  rules:
  - annotations:
      __alertId__: '318'
      __dashboardUid__: GDstorage
      __panelId__: '65102'
      message: ''
    condition: B
    dashboardUid: GDstorage
    data:
    - datasourceUid: '000000001'
      model:
        alias: Stratum $tag_stratum
        groupBy:
        - params:
          - $__interval
          type: time
        - params:
          - stratum
          type: tag
        - params:
          - 'null'
          type: fill
        interval: 1m
        measurement: chrony
        orderByTime: ASC
        policy: default
        query: SELECT mean(abs("rms_offset")) FROM "chrony" WHERE ("host" = 'storage')
          AND $timeFilter GROUP BY time($__interval), "stratum" fill(null)
        rawQuery: false
        refId: A
        resultFormat: time_series
        select:
        - - params:
            - rms_offset
            type: field
          - params: []
            type: mean
        tags:
        - key: host
          operator: =
          value: storage
      refId: A
      relativeTimeRange:
        from: 300
        to: 0
    - datasourceUid: __expr__
      model:
        conditions:
        - evaluator:
            params:
            - 1000
            - -1000
            type: outside_range
          operator:
            type: and
          query:
            params:
            - A
          reducer:
            type: avg
        refId: B
        type: classic_conditions
      refId: B
    execErrState: Error
    for: 20m
    isPaused: false
    labels:
      __contacts__: '"osd-admins"'
      rule_uid: LZA25ifVz
    noDataState: NoData
    panelId: 65102
    title: 'storage: NTP offset alert'
    uid: LZA25ifVz
- folder: Salt
  interval: 1m
  name: 'storage: Ping time alert'
  orgId: 1
  rules:
  - annotations:
      __alertId__: '314'
      __dashboardUid__: GDstorage
      __panelId__: '65098'
      message: ''
    condition: B
    dashboardUid: GDstorage
    data:
    - datasourceUid: '000000001'
      model:
        groupBy:
        - params:
          - $__interval
          type: time
        - params:
          - 'null'
          type: fill
        interval: 1m
        measurement: ping
        orderByTime: ASC
        policy: default
        refId: A
        resultFormat: time_series
        select:
        - - params:
            - average_response_ms
            type: field
          - params: []
            type: mean
        tags:
        - key: url
          operator: =
          value: storage.oqa.suse.de
      refId: A
      relativeTimeRange:
        from: 300
        to: 0
    - datasourceUid: __expr__
      model:
        conditions:
        - evaluator:
            params:
            - 200
            type: gt
          operator:
            type: and
          query:
            params:
            - A
          reducer:
            type: avg
        refId: B
        type: classic_conditions
      refId: B
    execErrState: Error
    for: 5m
    isPaused: false
    labels:
      __contacts__: '"osd-admins"'
      rule_uid: 1Z0hciBVz
    noDataState: NoData
    panelId: 65098
    title: 'storage: Ping time alert'
    uid: 1Z0hciBVz
- folder: Salt
  interval: 5m
  name: 'storage: host up alert'
  orgId: 1
  rules:
  - annotations:
      __alertId__: '315'
      __dashboardUid__: GDstorage
      __panelId__: '65105'
      message: |-
        No data received for pings from worker to central host, likely host is down (or split network).

        See https://progress.opensuse.org/issues/71098 for details
    condition: B
    dashboardUid: GDstorage
    data:
    - datasourceUid: '000000001'
      model:
        groupBy:
        - params:
          - $__interval
          type: time
        - params:
          - 'null'
          type: fill
        interval: 1m
        measurement: ping
        orderByTime: ASC
        policy: default
        refId: A
        resultFormat: time_series
        select:
        - - params:
            - average_response_ms
            type: field
          - params: []
            type: mean
        tags:
        - key: url
          operator: =
          value: storage.oqa.suse.de
      refId: A
      relativeTimeRange:
        from: 300
        to: 0
    - datasourceUid: __expr__
      model:
        conditions:
        - evaluator:
            params: []
            type: no_value
          operator:
            type: and
          query:
            params:
            - A
          reducer:
            type: avg
        refId: B
        type: classic_conditions
      refId: B
    execErrState: Error
    for: 1h30m
    isPaused: false
    labels:
      __contacts__: '"osd-admins"'
      rule_uid: BWAhcmf4k
    noDataState: NoData
    panelId: 65105
    title: 'storage: host up alert'
    uid: BWAhcmf4k
- folder: Salt
  interval: 1m
  name: 'storage: partitions usage (%) alert'
  orgId: 1
  rules:
  - annotations:
      __alertId__: '327'
      __dashboardUid__: GDstorage
      __panelId__: '65090'
      message: ''
    condition: A
    dashboardUid: GDstorage
    data:
    - datasourceUid: __expr__
      model:
        conditions:
        - evaluator:
            params:
            - 200
            type: gt
          operator:
            type: and
          query:
            params:
            - B
          reducer:
            type: avg
        - evaluator:
            params:
            - 85
            type: gt
          operator:
            type: or
          query:
            params:
            - B
          reducer:
            type: avg
        refId: A
        type: classic_conditions
      refId: A
    - datasourceUid: '000000001'
      model:
        alias: $tag_device ($tag_fstype)
        dsType: influxdb
        function: mean
        groupBy:
        - interval: auto
          params:
          - auto
          type: time
        - key: host
          params:
          - tag
          type: tag
        - key: path
          params:
          - tag
          type: tag
        interval: 1m
        measurement: disk_total
        orderByTime: ASC
        policy: default
        query: SELECT mean("used_percent") AS "used_percent" FROM "disk" WHERE ("host"
          = 'storage' AND fstype != 'nfs') AND $timeFilter GROUP BY time($interval),
          "device", "fstype" fill(null)
        rawQuery: true
        refId: B
        resultFormat: time_series
        select:
        - - params:
            - value
            type: field
          - params: []
            type: mean
        tags: []
      refId: B
      relativeTimeRange:
        from: 300
        to: 0
    execErrState: Error
    for: 5m
    isPaused: true
    labels:
      __contacts__: '"osd-admins"'
      rule_uid: EZ025if4k
    noDataState: NoData
    panelId: 65090
    title: 'storage: partitions usage (%) alert'
    uid: EZ025if4k
