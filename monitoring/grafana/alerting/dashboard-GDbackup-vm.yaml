---
apiVersion: 1
groups:
- folder: Salt
  interval: 1m
  name: 'backup-vm: Disk I/O time alert'
  orgId: 1
  rules:
  - annotations:
      __alertId__: '326'
      __dashboardUid__: GDbackup-vm
      __panelId__: '56720'
      message: ''
    condition: A
    dashboardUid: GDbackup-vm
    data:
    - datasourceUid: __expr__
      model:
        conditions:
        - evaluator:
            params:
            - 20000
            type: gt
          operator:
            type: and
          query:
            params:
            - C
          reducer:
            type: avg
        refId: A
        type: classic_conditions
      refId: A
    - datasourceUid: '000000001'
      model:
        alias: $tag_name
        groupBy:
        - params:
          - $__interval
          type: time
        - params:
          - name
          type: tag
        - params:
          - 'null'
          type: fill
        interval: 1m
        measurement: diskio
        orderByTime: ASC
        policy: default
        query: SELECT non_negative_derivative(mean("io_time"), 1s) FROM "diskio" WHERE
          ("host" = 'backup-vm' AND ("name" <> 'nvme0n1' OR "name" = 'nvme1n1' OR
          "name" = 'sda' OR "name" = 'sdb')) AND $timeFilter GROUP BY time($__interval),
          "name" fill(null)
        rawQuery: true
        refId: C
        resultFormat: time_series
        select:
        - - params:
            - read_time
            type: field
          - params: []
            type: mean
          - params:
            - 1s
            type: non_negative_derivative
        tags:
        - key: host
          operator: =
          value: backup-vm
        - condition: AND
          key: name
          operator: <>
          value: nvme0n1
        - condition: OR
          key: name
          operator: =
          value: nvme1n1
        - condition: OR
          key: name
          operator: =
          value: sda
        - condition: OR
          key: name
          operator: =
          value: sdb
      refId: C
      relativeTimeRange:
        from: 300
        to: 0
    execErrState: Error
    for: 5m
    isPaused: false
    labels:
      __contacts__: '"osd-admins"'
      rule_uid: eZ02cmfVz
    noDataState: NoData
    panelId: 56720
    title: 'backup-vm: Disk I/O time alert'
    uid: eZ02cmfVz
- folder: Salt
  interval: 1m
  name: 'backup-vm: Memory usage alert'
  orgId: 1
  rules:
  - annotations:
      __alertId__: '319'
      __dashboardUid__: GDbackup-vm
      __panelId__: '12054'
      message: ''
    condition: A
    dashboardUid: GDbackup-vm
    data:
    - datasourceUid: __expr__
      model:
        conditions:
        - evaluator:
            params:
            - 0.1
            type: lt
          operator:
            type: and
          query:
            params:
            - Available percentage
          reducer:
            type: avg
        refId: A
        type: classic_conditions
      refId: A
    - datasourceUid: '000000001'
      model:
        alias: available (percentage)
        dsType: influxdb
        function: mean
        groupBy:
        - interval: auto
          params:
          - auto
          type: time
        - key: host
          params:
          - tag
          type: tag
        interval: 1m
        measurement: mem_inactive
        orderByTime: ASC
        policy: default
        query: SELECT mean(available) / mean(total) as available_p  FROM "mem" WHERE
          host = 'backup-vm' AND $timeFilter GROUP BY time($interval), host ORDER
          BY asc
        rawQuery: true
        refId: Available percentage
        resultFormat: time_series
        select:
        - - params:
            - value
            type: field
          - params: []
            type: mean
        tags: []
      refId: Available percentage
      relativeTimeRange:
        from: 300
        to: 0
    execErrState: Error
    for: 5m
    isPaused: false
    labels:
      __contacts__: '"osd-admins"'
      rule_uid: QWA2cmf4k
    noDataState: NoData
    panelId: 12054
    title: 'backup-vm: Memory usage alert'
    uid: QWA2cmf4k
- folder: Salt
  interval: 1m
  name: 'backup-vm: NTP offset alert'
  orgId: 1
  rules:
  - annotations:
      __alertId__: '324'
      __dashboardUid__: GDbackup-vm
      __panelId__: '65102'
      message: ''
    condition: B
    dashboardUid: GDbackup-vm
    data:
    - datasourceUid: '000000001'
      model:
        alias: Stratum $tag_stratum
        groupBy:
        - params:
          - $__interval
          type: time
        - params:
          - stratum
          type: tag
        - params:
          - 'null'
          type: fill
        interval: 1m
        measurement: chrony
        orderByTime: ASC
        policy: default
        query: SELECT mean(abs("rms_offset")) FROM "chrony" WHERE ("host" = 'backup-vm')
          AND $timeFilter GROUP BY time($__interval), "stratum" fill(null)
        rawQuery: false
        refId: A
        resultFormat: time_series
        select:
        - - params:
            - rms_offset
            type: field
          - params: []
            type: mean
        tags:
        - key: host
          operator: =
          value: backup-vm
      refId: A
      relativeTimeRange:
        from: 300
        to: 0
    - datasourceUid: __expr__
      model:
        conditions:
        - evaluator:
            params:
            - 1000
            - -1000
            type: outside_range
          operator:
            type: and
          query:
            params:
            - A
          reducer:
            type: avg
        refId: B
        type: classic_conditions
      refId: B
    execErrState: Error
    for: 20m
    isPaused: false
    labels:
      __contacts__: '"osd-admins"'
      rule_uid: rW0hcifVk
    noDataState: NoData
    panelId: 65102
    title: 'backup-vm: NTP offset alert'
    uid: rW0hcifVk
- folder: Salt
  interval: 1m
  name: 'backup-vm: Ping time alert'
  orgId: 1
  rules:
  - annotations:
      __alertId__: '320'
      __dashboardUid__: GDbackup-vm
      __panelId__: '65098'
      message: ''
    condition: B
    dashboardUid: GDbackup-vm
    data:
    - datasourceUid: '000000001'
      model:
        groupBy:
        - params:
          - $__interval
          type: time
        - params:
          - 'null'
          type: fill
        interval: 1m
        measurement: ping
        orderByTime: ASC
        policy: default
        refId: A
        resultFormat: time_series
        select:
        - - params:
            - average_response_ms
            type: field
          - params: []
            type: mean
        tags:
        - key: url
          operator: =
          value: backup.qa.suse.de
      refId: A
      relativeTimeRange:
        from: 300
        to: 0
    - datasourceUid: __expr__
      model:
        conditions:
        - evaluator:
            params:
            - 200
            type: gt
          operator:
            type: and
          query:
            params:
            - A
          reducer:
            type: avg
        refId: B
        type: classic_conditions
      refId: B
    execErrState: Error
    for: 5m
    isPaused: false
    labels:
      __contacts__: '"osd-admins"'
      rule_uid: _W02cmBVk
    noDataState: NoData
    panelId: 65098
    title: 'backup-vm: Ping time alert'
    uid: _W02cmBVk
- folder: Salt
  interval: 5m
  name: 'backup-vm: host up alert'
  orgId: 1
  rules:
  - annotations:
      __alertId__: '321'
      __dashboardUid__: GDbackup-vm
      __panelId__: '65105'
      message: |-
        No data received for pings from worker to central host, likely host is down (or split network).

        See https://progress.opensuse.org/issues/71098 for details
    condition: B
    dashboardUid: GDbackup-vm
    data:
    - datasourceUid: '000000001'
      model:
        groupBy:
        - params:
          - $__interval
          type: time
        - params:
          - 'null'
          type: fill
        interval: 1m
        measurement: ping
        orderByTime: ASC
        policy: default
        refId: A
        resultFormat: time_series
        select:
        - - params:
            - average_response_ms
            type: field
          - params: []
            type: mean
        tags:
        - key: url
          operator: =
          value: backup.qa.suse.de
      refId: A
      relativeTimeRange:
        from: 300
        to: 0
    - datasourceUid: __expr__
      model:
        conditions:
        - evaluator:
            params: []
            type: no_value
          operator:
            type: and
          query:
            params:
            - A
          reducer:
            type: avg
        refId: B
        type: classic_conditions
      refId: B
    execErrState: Error
    for: 1h30m
    isPaused: false
    labels:
      __contacts__: '"osd-admins"'
      rule_uid: uZ025mfVk
    noDataState: NoData
    panelId: 65105
    title: 'backup-vm: host up alert'
    uid: uZ025mfVk
- folder: Salt
  interval: 1m
  name: 'backup-vm: partitions usage (%) alert'
  orgId: 1
  rules:
  - annotations:
      __alertId__: '325'
      __dashboardUid__: GDbackup-vm
      __panelId__: '65090'
      message: ''
    condition: A
    dashboardUid: GDbackup-vm
    data:
    - datasourceUid: __expr__
      model:
        conditions:
        - evaluator:
            params:
            - 200
            type: gt
          operator:
            type: and
          query:
            params:
            - B
          reducer:
            type: avg
        - evaluator:
            params:
            - 85
            type: gt
          operator:
            type: or
          query:
            params:
            - B
          reducer:
            type: avg
        refId: A
        type: classic_conditions
      refId: A
    - datasourceUid: '000000001'
      model:
        alias: $tag_device ($tag_fstype)
        dsType: influxdb
        function: mean
        groupBy:
        - interval: auto
          params:
          - auto
          type: time
        - key: host
          params:
          - tag
          type: tag
        - key: path
          params:
          - tag
          type: tag
        interval: 1m
        measurement: disk_total
        orderByTime: ASC
        policy: default
        query: SELECT mean("used_percent") AS "used_percent" FROM "disk" WHERE ("host"
          = 'backup-vm' AND fstype != 'nfs') AND $timeFilter GROUP BY time($interval),
          "device", "fstype" fill(null)
        rawQuery: true
        refId: B
        resultFormat: time_series
        select:
        - - params:
            - value
            type: field
          - params: []
            type: mean
        tags: []
      refId: B
      relativeTimeRange:
        from: 300
        to: 0
    execErrState: Error
    for: 5m
    isPaused: false
    labels:
      __contacts__: '"osd-admins"'
      rule_uid: jWAhcif4k
    noDataState: NoData
    panelId: 65090
    title: 'backup-vm: partitions usage (%) alert'
    uid: jWAhcif4k
