#!/bin/bash

BDIR="{{ snapshot_root_path }}"

declare -a CHECK_HOSTS=(
        "localhost"
{%- if grains.get("roles", '') == 'backup_prg2' -%}
        "openqa.suse.de"
{% endif %}
        "openqa.opensuse.org"
        "jenkins.qa.suse.de"
        "openqa-monitor.qa.suse.de"
        "s.qa.suse.de"
)

exitcode=0

for h in "${CHECK_HOSTS[@]}" ; do
	bloc="$BDIR/alpha.0/$h"
	if [[ ! -d "$bloc" ]] ; then
			echo "'$bloc' does not exist!"
			exitcode=1
	fi
done

exit $exitcode
